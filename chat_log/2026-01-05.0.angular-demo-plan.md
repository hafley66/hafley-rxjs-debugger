# 2026-01-05 - Angular Demo Plan

## Goal
Demo RxJS HMR debugger in real Angular projects to pitch to Angular community (who have zero HMR support for observables).

## Target Projects
1. **NgRx Official Example App** - https://github.com/ngrx/platform/tree/master/projects/example-app
   - Book collection manager with Google Books API
   - Uses @ngrx/store, @ngrx/effects, @angular/router
   - Most recognizable to NgRx users

2. **Angular NgRx RealWorld** - https://github.com/stefanoslig/angular-ngrx-nx-realworld-example-app
   - RealWorld spec implementation (CRUD, auth, routing, pagination)
   - Angular 21 + NgRx 21 + Nx
   - Good for showing complex real-world patterns

## Technical Approach

### Angular 17+ Plugin Integration
Angular CLI encapsulates Vite - no direct `vite.config.ts`. Need esbuild plugin (not Vite plugin).

**Key insight:** Transform logic in `0_user-transform.ts` is bundler-agnostic. Just need different plugin wrapper.

```typescript
// src/esbuild-plugin/index.ts
import { transformUserCode } from '../vite-plugin/0_user-transform'

export const rxjsDebuggerEsbuild = (): esbuild.Plugin => ({
  name: 'rxjs-debugger',
  setup(build) {
    build.onLoad({ filter: /\.(ts|tsx)$/ }, async (args) => {
      const code = await fs.readFile(args.path, 'utf8')
      const result = transformUserCode(code, args.path)
      if (result) {
        return { contents: result.code, loader: 'ts' }
      }
      return null
    })
  }
})
```

Then configure in `angular.json`:
```json
{
  "architect": {
    "build": {
      "builder": "@angular-builders/custom-esbuild:application",
      "options": {
        "plugins": ["./rxjs-debugger-esbuild.js"]
      }
    }
  }
}
```

### Debugger UI
- **Overlay panel** rendered to DOM element (not shadow DOM)
- Portable to browser extension later
- Use existing React `DebuggerGrid` component
- Inject via small bootstrap script that mounts React to a container div

## Tasks

### Phase 1: esbuild Plugin (in this repo)
- [ ] Create `src/esbuild-plugin/index.ts` - esbuild wrapper around `transformUserCode`
- [ ] Handle RxJS internal patching via esbuild (patch Observable.js etc)
- [ ] Export from package.json as `@hafley/rxjs-debugger/esbuild`
- [ ] Test esbuild plugin standalone (without Angular)

### Phase 2: Demo Project Setup
- [ ] Fork/clone NgRx example-app locally
- [ ] Fork/clone angular-ngrx-nx-realworld locally
- [ ] Verify both build with Angular 17+ (esbuild mode)

### Phase 3: Angular Integration
- [ ] Install `@angular-builders/custom-esbuild` in demo project
- [ ] Configure `angular.json` to use custom builder + our plugin
- [ ] Verify plugin transforms RxJS code (check source maps)
- [ ] Debug any Angular-specific transform edge cases

### Phase 4: Debugger Overlay
- [ ] Create `debugger-overlay.tsx` - minimal React mount point
- [ ] Style as floating panel (position: fixed, draggable?)
- [ ] Inject via plugin transform (append to index.html or entry)
- [ ] Test overlay shows observable tree for NgRx effects/selectors

### Phase 5: HMR Demo Recording
- [ ] Identify good HMR demo scenario (edit an effect, see state preserved)
- [ ] Record demo video/gif showing before/after
- [ ] Write up pitch for Angular community

## Files to Create

### In hafley-rxjs-debugger
- `src/esbuild-plugin/index.ts` - esbuild plugin wrapping `transformUserCode`
- `src/esbuild-plugin/patch-rxjs.ts` - esbuild transform for RxJS internals
- `src/tracking/v2/ui/1_DebuggerOverlay.tsx` - Standalone overlay component
- `package.json` - add export for `./esbuild`

### In demo repos (external)
- `angular.json` - Configure custom builder
- `package.json` - Add dependencies

## Notes
- Angular devs get React debugger UI, they can deal
- Design overlay to be portable to browser extension later
- Angular encapsulates Vite, only exposes esbuild - need esbuild plugin not Vite plugin
- Transform logic in `0_user-transform.ts` is bundler-agnostic, just need different plugin shell
- `@angular-builders/custom-esbuild` lets us inject our esbuild plugin into Angular CLI

## Sources
- https://v17.angular.io/guide/esbuild
- https://www.npmjs.com/package/@angular-builders/custom-esbuild
- https://www.angulartraining.com/daily-newsletter/angular-17-new-esbuild-builder-with-vite/
