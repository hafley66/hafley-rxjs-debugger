# 2025-12-29 RxJS Debugger v2 - Phase 1 Complete

## Completed
- **01_helpers.ts**: ID gen (mono int in test mode), perf timing, observableIdMap WeakMap
- **00.types.ts**: Refined entity model - unified observable (collapse Subject/BehaviorSubject/create), dual timespans (created_at/created_at_end, unsubscribed_at/unsubscribed_at_end), ObservableRef type, removed separate subject/bsubject/create entities
- **00.class-proxy.ts**: Use createId() helper, fixed unsubscribe infinite recursion
- **03_scan-accumulator.ts**: Eventâ†’state scan logic for constructor/pipe/subscribe/unsubscribe
- **00.class-proxy.test.ts**: All passing with vi.useFakeTimers + performance.now mock, snapshot assertions

## Key Decisions
- Stack semantics: `-get` = push (higher prec), `-call-return` = pop
- WeakMap mutation happens in scan, not proxy (FRP)
- Dual timespans on all entities (optional created_at_end)
- Subscription stays on stack until unsubscribe (dual timespan: call-time scope + async lifespan)
- No args_hash (object identity sufficient)
- rel array approach: snapshot execution context (discussed alternatives - simultaneity/semantic types/multiple parents/async gaps make single owner_id insufficient)

## Next: Phase 2
1. 02_arg-crawler.ts - extract ObservableRef[] with lodash paths + `.$return` sigil
2. decorateCreate - merge/combineLatest tests
3. decorateOperatorFun - map/filter/scan/repeat/share/withLatestFrom/switchMap tests
4. Higher-order special handling: wrap callbacks, push context, WeakMap tag for async preservation

## Next: Phase 3
- Intercept Observable constructor subscriber arg
- Normalize 3 observer forms (fn/obj/3-arg)
- Wrap next/error/complete to emit send events
- Add send handlers to scan
- Tests for all observer forms

## Files Changed
- src/tracking/v2/01_helpers.ts (new)
- src/tracking/v2/00.types.ts (entities refined)
- src/tracking/v2/00.class-proxy.ts (helpers, unsubscribe fix)
- src/tracking/v2/03_scan-accumulator.ts (new)
- src/tracking/v2/00.class-proxy.test.ts (3 tests passing)

## Corrections & Learnings
1. **FRP discipline**: State mutations (WeakMap) belong in scan, not proxy - keep event emitters pure
2. **Test assertions**: Use exact snapshots (toEqual) not relative checks (toBeTypeOf, toHaveLength) - "snapshot literal values as much as possible bc that is what matters"
3. **Test ergonomics**: Mock performance.now with vi.spyOn + Date.now bridge, check NODE_ENV for test mode (not custom flags)
4. **DRY balance**: Abstract setup to beforeEach, but don't create "WET oblivion" - find minimal abstraction for max coverage
5. **Stack semantics precision**: `-get` fires before `-call` (OOP getter trap), so get=push, call-return=pop
6. **Don't over-agent**: Think through architecture problems directly instead of spawning research agents for things that need decision not research
7. **Infinite recursion fix**: Cache original method before defineProperty to avoid recursive getter traps
